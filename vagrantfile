Vagrant.configure("2") do |config|
  nodes = [
    { hostname: "NameNode", ip: "192.168.56.10", ports: { 50070 => 50070, 8088 => 8088, 9870 => 9870 } },
    { hostname: "DataNode1", ip: "192.168.56.11", ports: {} },
    { hostname: "DataNode2", ip: "192.168.56.12", ports: {} }
  ]

  nodes.each do |node|
    config.vm.define node[:hostname] do |node_config|
      node_config.vm.box = "ubuntu/bionic64"
      node_config.vm.hostname = node[:hostname]
      node_config.vm.network "private_network", ip: node[:ip]

      node[:ports].each do |guest, host|
        node_config.vm.network "forwarded_port", guest: guest, host: host
      end

      node_config.vm.provider "virtualbox" do |vb|
        vb.gui = false
        vb.memory = "1024"
        vb.cpus = 1
      end

      # Provisioning for only the first "vagrant up"
      node_config.vm.provision "shell", path: "scripts/ssh_conf.sh", run: "once"
      node_config.vm.provision "shell", path: "scripts/IP_conf.sh", run: "once"
      node_config.vm.provision "shell", path: "scripts/java_conf.sh", run: "once"
      node_config.vm.provision "shell", path: "scripts/hadoop_conf.sh", run: "once"
      # Verify whether the file flag exists before executing the other scripts
      node_config.vm.provision "shell", inline: <<-SHELL
if [ ! -f /home/vagrant/.provisioned ]; then
  touch /home/vagrant/.provisioned
else
  if [ "$(hostname)" == "NameNode" ]; then
  	bash /vagrant/scripts/core_conf.sh
  	bash /vagrant/scripts/hdfs_conf.sh
  	bash /vagrant/scripts/yarn_conf.sh
  	bash /vagrant/scripts/mapred_conf.sh
  	bash /vagrant/scripts/hadoop_env.sh
  	bash /vagrant/scripts/scp_conf.sh
  fi
fi
SHELL
    end
  end
end
  #  bash /vagrant/scripts/core_conf.sh
  # bash /vagrant/scripts/hdfs_conf.sh
  #bash /vagrant/scripts/yarn_conf.sh
  #bash /vagrant/scripts/mapred_conf.sh
  #bash /vagrant/scripts/hadoop_env.sh
  #  bash /vagrant/scripts/scp_conf.sh
  # bash /vagrant/scripts/format_conf.sh
